<!DOCTYPE html>
<html>
<head>
    <title>Registro Form</title>
</head>
<body>
    <h1>{{ form.instance.pk|yesno:"Edit Registro,Create Registro" }}</h1>
    <form method="post" id = "formFruta">
        {% csrf_token %}
        {{ form.as_p }}

        <button type="submit">Save</button>
    </form>
    <a href="{% url 'salidasFruta_list' %}">Back to list</a>

</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Función para cargar productos basados en la categoría seleccionada
        function consultarUsuario() {
            $.ajax({
                url: '{% url "obtener_nombre_usuario" %}',  // URL para la vista AJAX
                data: {
                    'category_id': "Consulta"  // Envia el ID de la categoría como parámetro
                },
                success: function(data) {
                    // Limpia las opciones actuales del campo 'name'
                    var initialCategoryId =data.username;  // Obtiene el valor inicial del campo 'category'
                    if (initialCategoryId) {
                        loadProducts(initialCategoryId);
                    }
                
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);  // Maneja errores de la solicitud
                }
            });
        }
        function loadProducts(categoryId) {
            $.ajax({
                url: '{% url "load_dataUsuario" %}',  // URL para la vista AJAX
                data: {
                    'category_id': categoryId  // Envia el ID de la categoría como parámetro
                },
                success: function(data) {
                    // Limpia las opciones actuales del campo 'name'
                    console.log(data);
                    $('#id_finca').html('');
                    // Recorre los productos recibidos y añade opciones al campo 'name'
                    $.each(data.datos, function(index, product) {
                        $('#id_finca').append(
                            $('<option>').text(product.finca).attr('value', product.finca)
                        );
                    });

                    $('#id_encargado').html('');
                    // Recorre los productos recibidos y añade opciones al campo 'name'
                    $.each(data.datos, function(index, product) {
                        $('#id_encargado').append(
                            $('<option>').text(product.encargado).attr('value', product.encargado)
                        );
                    });

                    $('#id_correo').html('');
                    // Recorre los productos recibidos y añade opciones al campo 'name'
                    $('#id_correo').append(
                        $('<option>').text(data.correo).attr('value', data.correo)
                    );

                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);  // Maneja errores de la solicitud
                }
            });
        }
        consultarUsuario();
        // Llama a la función de carga de productos al cargar la página
        
    });
</script>
</html>