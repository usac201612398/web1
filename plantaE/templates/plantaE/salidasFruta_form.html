<!DOCTYPE html>
<html>
<head>
    <title>Registro Form</title>
</head>
<body>
    <h1>{{ form.instance.pk|yesno:"Edit Registro,Create Registro" }}</h1>
    <form method="post" id = "formFruta">
        {% csrf_token %}
        {% if user.username == 'brandon.portillo@popoyan.com.gt'%}
        {% else %}
        {% endif %}
        {{ form.as_p }}

        <button type="submit">Save</button>
    </form>
    <a href="{% url 'salidasFruta_list' %}">Back to list</a>

</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Realiza la solicitud AJAX cuando se carga la página
        function loadProducts() {
            var categoryId = $('#id_category').val(); // Obtén el valor de la categoría seleccionada
            $.ajax({
                url: '{% url "load_products" %}',  // URL de la vista AJAX
                data: {
                    'category_id': user.username
                },
                success: function(data) {
                    $('#id_name').html('');  // Limpia las opciones del campo de productos
                    $.each(data.products, function(index, product) {
                        console.log(response)
                        $('#id_name').append(
                            $('<option>').text(product.name).attr('value', product.id)
                        );
                    });
                }
            });
        }

        // Llama a la función de carga de productos al cargar la página
        loadProducts();

        // Escucha el cambio en el campo de categoría para actualizar los productos
        $('#id_category').change(function() {
            loadProducts();
        });
    });
</script>
</html>