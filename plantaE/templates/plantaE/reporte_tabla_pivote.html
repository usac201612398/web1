
{% load static %}
{% load custom_tags %}
{% block content %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
<div class="container mt-4">
    <h2 class="mb-4">Tabla Pivote - Kg por m² por Semana</h2>

    <!-- Filtros (idéntico a los del dashboard) -->
    <form method="get" class="row g-3 mb-4">
        {% for nombre, campo, valores in filtros_completos %}
        <div class="col-md-2">
            <label class="form-label">{{ nombre }}</label>
            <select name="{{ campo }}" class="form-select">
                <option value="">Todos</option>
                {% for valor in valores %}
                    <option value="{{ valor }}" {% if request.GET|get_item:campo == valor %}selected{% endif %}>{{ valor }}</option>
                {% endfor %}
            </select>
        </div>
        {% endfor %}
        <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Aplicar filtros</button>
        </div>
    </form>

    <div style="overflow-x: auto;">
        {{ tabla_html|safe }}
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>

<script>
    $(document).ready(function () {
        $('#tabla-pivote').DataTable({
            scrollX: true,
            dom: 'Bfrtip',
            buttons: ['excelHtml5', 'csvHtml5'],
            language: {
                url: "//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json"
            }
        });
    });
</script>
{% endblock %}
