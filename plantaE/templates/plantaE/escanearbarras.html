<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escanear Código de Barras</title>
    <style>
        #videoElement {
            width: 100%;
            height: 400px;
            border: 1px solid black;
            background-color: black;
        }
    </style>
</head>
<body>
    <h1>Escanear Código de Barras con QuaggaJS</h1>

    <video id="videoElement" autoplay></video>
    <p>Escaneado: <span id="result">Ningún código escaneado</span></p>

    <!-- Cargar QuaggaJS desde el CDN -->
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>

    <script>
        // Función para obtener acceso a la cámara
        function obtenerCamaras() {
            // Obtener el dispositivo de la cámara
            navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: "environment" // Preferir la cámara trasera (en dispositivos móviles)
                }
            })
            .then(function(stream) {
                // Si se obtiene el stream de la cámara, lo asignamos al elemento video
                document.getElementById('videoElement').srcObject = stream;

                // Llamamos a Quagga para iniciar el escaneo
                iniciarEscaneo();
            })
            .catch(function(err) {
                console.error("Error al acceder a la cámara: ", err);
                alert('No se pudo acceder a la cámara. Asegúrate de otorgar los permisos necesarios.');
            });
        }

        // Iniciar el escaneo de código de barras con QuaggaJS
        function iniciarEscaneo() {
            const videoElement = document.getElementById('videoElement');
            const resultElement = document.getElementById('result');

            // Inicializar Quagga con configuración adecuada
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: videoElement, // Asignamos el video elemento para mostrar el stream
                },
                decoder: {
                    readers: ["code_128_reader", "ean_reader", "ean_8_reader", "upc_reader"] // Definir los tipos de códigos de barras que leeremos
                }
            }, function(err) {
                if (err) {
                    console.error(err);
                    alert('Error al iniciar el escáner: ' + err);
                    return;
                }

                console.log("Escáner iniciado");
                Quagga.start(); // Iniciar escaneo

                // Detectar el código de barras y mostrar el resultado
                Quagga.onDetected(function(data) {
                    console.log("Código escaneado:", data);
                    resultElement.textContent = `Código escaneado: ${data.codeResult.code}`;
                });
            });
        }

        window.onload = function() {
            obtenerCamaras(); // Llamamos la función para obtener la cámara y comenzar el escaneo
        };
    </script>
</body>
</html>




