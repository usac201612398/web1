<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escanear Código de Barras con Zona de Detección</title>
    <style>
        /* Estilo para el video */
        #videoElement {
            width: 100%;
            height: 400px;
            border: 1px solid black;
            background-color: black;
        }

        /* Estilo para el marco de escaneo */
        #scanFrame {
            position: absolute;
            top: 50px; /* Ajusta para poner el marco en la parte superior */
            left: 100px; /* Ajusta para centrar o mover el marco */
            width: 800px; /* Ancho del marco */
            height: 200px; /* Altura del marco */
            border: 3px solid red; /* Color y grosor del borde */
            box-sizing: border-box;
            pointer-events: none; /* Asegura que el marco no interfiera con los clics */
        }

        /* Estilo para asegurar que el marco esté sobre el video */
        .videoContainer {
            position: relative;
            display: inline-block;
        }
    </style>
</head>
<body>
    <h1>Escanear Código de Barras con Zona de Detección</h1>

    <div class="videoContainer">
        <video id="videoElement" autoplay></video>
        <div id="scanFrame"></div> <!-- Marco visual del área de escaneo -->
    </div>

    <p>Escaneado: <span id="result">Ningún código escaneado</span></p>

    <!-- Cargar QuaggaJS desde el CDN -->
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>

    <script>
        // Función para obtener acceso a la cámara
        function obtenerCamaras() {
            // Obtener el dispositivo de la cámara
            navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: "environment" // Preferir la cámara trasera (en dispositivos móviles)
                }
            })
            .then(function(stream) {
                // Si se obtiene el stream de la cámara, lo asignamos al elemento video
                document.getElementById('videoElement').srcObject = stream;

                // Llamamos a Quagga para iniciar el escaneo
                iniciarEscaneo();
            })
            .catch(function(err) {
                console.error("Error al acceder a la cámara: ", err);
                alert('No se pudo acceder a la cámara. Asegúrate de otorgar los permisos necesarios.');
            });
        }

        // Iniciar el escaneo de código de barras con QuaggaJS
        function iniciarEscaneo() {
            const videoElement = document.getElementById('videoElement');
            const resultElement = document.getElementById('result');

            // Inicializar Quagga con configuración adecuada
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: videoElement, // Asignamos el video elemento para mostrar el stream
                },
                locator: {
                    patchSize: "medium", // Tamaño de los parches utilizados para la localización
                    halfSample: true, // Utiliza una resolución más baja para hacer la detección más rápida
                    width: 800,  // Ancho del área (ajústalo según el tamaño del video)
                    height: 200, // Altura del área (ajústalo para cubrir la parte superior)
                    x: 100,      // Posición X de la zona (ajusta para centrarla en la parte superior)
                    y: 50,       // Posición Y de la zona (ajústalo para cubrir la parte superior)
                },
                decoder: {
                    readers: ["code_128_reader", "ean_reader", "ean_8_reader", "upc_reader"] // Definir los tipos de códigos de barras que leeremos
                }
            }, function(err) {
                if (err) {
                    console.error(err);
                    alert('Error al iniciar el escáner: ' + err);
                    return;
                }

                console.log("Escáner iniciado");
                Quagga.start(); // Iniciar escaneo

                // Detectar el código de barras y mostrar el resultado
                Quagga.onDetected(function(data) {
                    console.log("Código escaneado:", data);
                    resultElement.textContent = `Código escaneado: ${data.codeResult.code}`;
                });
            });
        }

        window.onload = function() {
            obtenerCamaras(); // Llamamos la función para obtener la cámara y comenzar el escaneo
        };
    </script>
</body>
</html>





